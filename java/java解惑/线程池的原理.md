线程池的原理
===

- 在什么情况下使用线程池？ 
    - 单个任务处理的时间比较短 
    - 将需处理的任务的数量大 
	
- 使用线程池的好处: 
    - 减少在创建和销毁线程上所花的时间以及系统资源的开销 
    - 如不使用线程池，有可能造成系统创建大量线程而导致消耗完系统内存以及”过度切换”。 
	-  提交相应速度
	
- 工作流程
    线程池的任务就在于负责这些线程的创建，销毁和任务处理参数传递、唤醒和等待。
    - 创建若干线程，置入线程池
    - 任务达到时，从线程池取空闲线程
    - 取得了空闲线程，立即进行任务处理
    - 否则新建一个线程，并置入线程池，执行3
    - 如果创建失败或者线程池已满，根据设计策略选择返回错误或将任务置入处理队列，等待处理
    - 销毁线程池
	
- 风险
    虽然线程池是构建多线程应用程序的强大机制，但使用它并不是没有风险的。
	用线程池构建的应用程序容易遭受任何其它多线程应用程序容易遭受的所有并发风险，诸如同步错误和死锁，
	它还容易遭受特定于线程池的少数其它风险，诸如与池有关的死锁、资源不足和线程泄漏。
	
- 资源不足
    线程池的一个优点在于：相对于其它替代调度机制而言，它们通常执行得很好。但只有恰当地调整了线程池大小时才是这样的。
	线程消耗包括内存和其它系统资源在内的大量资源。除了`Thread`对象所需的内存之外，每个线程都需要两个可能很大的执行调用堆栈。
	除此以外`JVM`可能会为每个`Java`线程创建一个本机线程，这些本机线程将消耗额外的系统资源。最后虽然线程之间切换的调度开销很小，
	但如果有很多线程，环境切换也可能严重地影响程序的性能。
    如果线程池太大，那么被那些线程消耗的资源可能严重地影响系统性能。在线程之间进行切换将会浪费时间，
	而且使用超出比您实际需要的线程可能会引起资源匮乏问题，因为池线程正在消耗一些资源，而这些资源可能会被其它任务更有效地利用。
	除了线程自身所使用的资源以外，服务请求时所做的工作可能需要其它资源，例如`JDBC`连接、套接字或文件。
	这些也都是有限资源，有太多的并发请求也可能引起失效，例如不能分配`JDBC`连接。	
	
- 线程池的关闭
    我们可以通过调用线程池的`shutdown`或`shutdownNow`方法来关闭线程池，它们的原理是遍历线程池中的工作线程，然后逐个调用线程的`interrupt`方法来中断线程，所以无法响应中断的任务可能永远无法终止。
	但是它们存在一定的区别，`shutdownNow`首先将线程池的状态设置成`STOP`，然后尝试停止所有的正在执行或暂停任务的线程，并返回等待执行任务的列表，
	而`shutdown`只是将线程池的状态设置成`SHUTDOWN`状态，然后中断所有没有正在执行任务的线程。
    只要调用了这两个关闭方法的其中一个，`isShutdown`方法就会返回`true`。当所有的任务都已关闭后,才表示线程池关闭成功，
	这时调用`isTerminaed`方法会返回`true`。至于我们应该调用哪一种方法来关闭线程池，应该由提交到线程池的任务特性决定，通常调用`shutdown`来关闭线程池，如果任务不一定要执行完，则可以调用`shutdownNow`。	

---

	
